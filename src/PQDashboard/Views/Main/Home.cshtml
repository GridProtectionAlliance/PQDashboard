@*******************************************************************************************************
    //  Home.cshtml - Gbtc
    //
    //  Copyright © 2016, Grid Protection Alliance.  All Rights Reserved.
    //
    //  Licensed to the Grid Protection Alliance (GPA) under one or more contributor license agreements. See
    //  the NOTICE file distributed with this work for additional information regarding copyright ownership.
    //  The GPA licenses this file to you under the MIT License (MIT), the "License"; you may not use this
    //  file except in compliance with the License. You may obtain a copy of the License at:
    //
    //      http://opensource.org/licenses/MIT
    //
    //  Unless agreed to in writing, the subject software distributed under the License is distributed on an
    //  "AS-IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. Refer to the
    //  License for the specific language governing permissions and limitations.
    //
    //  Code Modification History:
    //  ----------------------------------------------------------------------------------------------------
    //  01/22/2016 - J. Ritchie Carroll
    //       Generated original version of source code.
    //
    //*****************************************************************************************************@
@using GSF
@using GSF.Data
@using GSF.Collections;

@using GSF.Data.Model
@using GSF.Identity
@using GSF.Web.Model
@using PQDashboard.Model
@model AppModel
@{
    Layout = "";
    DataContext dataContext = Model.DataContext;
    string historianConnection = dataContext.Connection.ExecuteScalar<string>("SELECT Value FROM Setting WHERE Name = 'Historian.URL'");
    IEnumerable<MeterGroup> meterGroups = dataContext.Table<MeterGroup>().QueryRecords(restriction: new RecordRestriction("ID IN (SELECT MeterGroupID FROM UserAccountMeterGroup WHERE UserAccountID IN (SELECT ID FROM UserAccount WHERE Name = {0}))", ViewBag.usersid));
    List<DashSettings> dashSettings = dataContext.Table<DashSettings>().QueryRecords().ToList();
    List<UserDashSettings> userDashSettings = dataContext.Table<UserDashSettings>().QueryRecords(restriction: new RecordRestriction("UserAccountID IN (SELECT ID FROM UserAccount WHERE Name = {0})", ViewBag.usersid)).ToList();
    foreach(DashSettings setting in dashSettings)
    {
        if (setting.Name == "DashTab" || setting.Name.EndsWith("Chart"))
        {
            var index = userDashSettings.IndexOf(x => x.Name == setting.Name && x.Value == setting.Value);
            if (index >= 0)
            {
                setting.Enabled = userDashSettings[index].Enabled;
            }
        }
        else if (setting.Name.EndsWith("Colors"))
        {
            var index = userDashSettings.IndexOf(x => x.Name == setting.Name && x.Value.Split(',')[0] == setting.Value.Split(',')[0]);
            if (index >= 0)
            {
                setting.Value = userDashSettings[index].Value;
            }
        }
    }

    string xdaInstance = dataContext.Connection.ExecuteScalar<string>("SELECT Value FROM DashSettings WHERE Name = 'XDAInstance'");
    string yearBegin = dataContext.Connection.ExecuteScalar<string>("SELECT Value FROM DashSettings WHERE Name = 'YearBeginDate'") ?? "January 1";

    int defaulMeterGroupID = -1;

    if (meterGroups.Any())
    {
        defaulMeterGroupID = meterGroups.First().ID;
    }
}
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Open PQ Dashboard :: @ViewBag.username</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta charset="utf-8"/>
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <link rel="shortcut icon" type="image/ico" href="~/favicon.ico" />
    <link rel="stylesheet" href="~/Content/bootstrap/theme.css"/>
    <link rel="stylesheet" type="text/css" href="~/Content/font-awesome.css" />
    <link rel="stylesheet" href="~/Content/bootstrap-3.3.2.min.css"/>
    <link rel="stylesheet" href="~/Content/themes/redmond/jquery-ui.css"/>
    <link rel="stylesheet" href="~/Scripts/PrimeUI/primeui.min.css"/>
    <link rel="stylesheet" href="~/Content/jquery.multiselect.css"/>
    <link rel="stylesheet" href="~/Content/jquery.multiselect.filter.css"/>
    <link rel="stylesheet" href="~/Content/Default.css" type="text/css"/>
    <link rel="stylesheet" href="~/Content/bootstrap-multiselect.css"/>
    <link rel="stylesheet" href="~/Content/daterangepicker.css"/>
    <link rel="stylesheet" type="text/css" href="~/Scripts/Leaflet/leaflet1.0.css"/>
    <script>
        var mg = @defaulMeterGroupID;
        var homePath = '@Html.Raw(Url.Content("~/"))';
        var historianConnection = '@historianConnection';
        var xdaInstance = '@xdaInstance';
        var yearBegin = '@yearBegin';
        var userId = '@ViewBag.usersid';
    </script>
    <script type="text/javascript" src="~/Scripts/jquery-2.1.1.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery-ui.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery.signalR-2.2.0.js"></script>
    <script type="text/javascript" src="~/Scripts/jscolor.js"></script>
    <script type="text/javascript" src="~/Scripts/masonry.pkdg.min.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery.blockUI.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery.sparkline.js"></script>
    <script type="text/javascript" src="~/Scripts/bootstrap-3.3.2.min.js"></script>
    <script type="text/javascript" src="~/Scripts/bootstrap-multiselect.js"></script>
    <script type="text/javascript" src="~/Scripts/PrimeUI/primeui.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery.multiselect.js"></script>
    <script type="text/javascript" src="~/Scripts/jquery.multiselect.filter.js"></script>
    <script type="text/javascript" src="~/Scripts/moment.min.js"></script>
    <script type="text/javascript" src="~/Scripts/daterangepicker.js"></script>

    <script src="~/signalr/hubs"></script>
    <script type="text/javascript" src="~/Scripts/Site.js"></script>
    <script type="text/javascript" src="~/Scripts/Default.js"></script>
    <script type="text/javascript" src="~/Scripts/jstorage.js"></script> 
    <script type="text/javascript" src="~/Scripts/moment.js"></script> 
    <script type="text/javascript" src="~/Scripts/D3/d3.js" charset="utf-8"></script>
    <script type="text/javascript" src="~/Scripts/D3/d3-color.v1.min.js"></script>
    <script type="text/javascript" src="~/Scripts/D3/d3-interpolate.v1.min.js"></script>
    <script type="text/javascript" src="~/Scripts/D3/d3-scale.v1.min.js"></script>
    <script type="text/javascript" src="~/Scripts/D3/d3-shape.v1.min.js"></script>
    <script type="text/javascript" src="~/Scripts/Leaflet/leaflet-src.js"></script>
    <script type="text/javascript" src="~/Scripts/plotly-latest.min.js"></script>
    <script src="~/Scripts/heatmap.js"></script>
    <script src="~/Scripts/leaflet-heatmap.js"></script>
  	<script type="text/javascript" src="~/Scripts/flot/jquery.flot.js"></script>
	<script type="text/javascript" src="~/Scripts/flot/jquery.flot.errorbars.js"></script>
	<script type="text/javascript" src="~/Scripts/flot/jquery.flot.navigate.js"></script>
  	<script type="text/javascript" src="~/Scripts/flot/jquery.flot.resize.js"></script>
  	<script type="text/javascript" src="~/Scripts/flot/jquery.flot.time.js"></script>
   	<script type="text/javascript" src="~/Scripts/flot/jquery.flot.selection.js"></script>
  
</head>

<body onunload="createupdateconfig(null);">

<div style="visibility: hidden; width: 0px; height: 0px;" id="postedUserName">@ViewBag.usersid</div>

<div id="draggable" class="ui-widget-content"></div>
<div style="width: 100%; height: 36px;">
    <table width="100%">
        <tr>
            <td width="33%" align="left"><img src="~/Images/GPA-Logo---30-pix(on-white).png"/></td>
            <td width="33%" align="center"><img src="~/Images/PQ-Dashboard.png"/></td>
            <td width="34%" align="right" valign="top" nowrap><img src="~/Images/EPRI(c).jpg"/></td>
        </tr>
    </table>
</div>


<div id="ApplicationContent" class="noselect">
<div id="headerStrip" class="headerStrip ui-state-default noselect">
    <table style="width: 100%;">
        <tr>
            <td width="15%" align="left" style="z-index: 999; padding-left: 5px;" nowrap>
                Device Filter:
                <select class="smallbutton" id="deviceFilterList">
                    <option>All (no filter)</option>
                </select>
                <button class="smallbutton" id="newDeviceFilterBtn" onclick="">New</button>
                <button class="smallbutton" id="editDeviceFilterBtn" onclick="">Edit</button>

                <select class="smallbutton" id="Configurations" hidden="hidden"></select>
                <button class="smallbutton" id="ConfigurationsLoad" onclick="configurationapply($('#Configurations').val())" hidden="hidden">Load</button>
                <button class="smallbutton" id="ConfigurationsCopy" onclick="configurationscopy(this);" hidden="hidden">New</button>
                <button class="smallbutton" id="ConfigurationsUpdate" onclick="configurationsupdate(this);" hidden="hidden">Save</button>
                <button class="smallbutton" id="ConfigurationsDelete" onclick="configurationsdelete(this);" hidden="hidden">Delete</button>
            </td>
            <td width="25%" align="left" nowrap>
                <span id="meterSelected">11</span> of <span id="meterCount">23</span> devices selected
                @*Site:*@
                <select id="siteList" multiple="multiple" hidden="hidden"></select>
            </td>

            <td width="20%" align="left" nowrap>
                <div class="row">
                    <div class="col-md-2">
                        <button type="button" class="btn btn-default" onclick="moveDateBackward()" title="Move 1 step back in time"><span class="glyphicon glyphicon-backward"></span></button>
                    </div>
                    <div class="col-md-8">
                        
                        <div id="dateRange" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%">

                            <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>&nbsp;
                            <span id="dateRangeSpan"></span> <b class="caret"></b>

                        </div>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-default" onclick="moveDateForward()" title="Move 1 step forward in time"><span class="glyphicon glyphicon-forward"></span></button>
                    </div>

                </div>


            </td>

            <td width="5%" align="right" style="z-index: 999; padding-right: 20px;" nowrap>
                Welcome:
                <span>@ViewBag.username</span>
            </td>
            <td width="10%" align="right" style="z-index: 999; padding-right: 5px;" nowrap>
                @*Monitor Group:*@
                <select id="meterGroupSelect" class="smallbutton" onchange="selectMeterGroup(this);" hidden="hidden">
                    @foreach (MeterGroup mg in meterGroups)
                    {
                        <option value="@mg.ID">@mg.Name</option>
                    }
                </select>
                Saved Views:
                <select id="viewSelect" class="smallbutton" onchange="">
                    <option>My View</option>
                </select>
                <button class="smallbutton" id="saveNewView" onclick="">Save</button>
                <button class="smallbutton" id="deleteView" onclick="">Delete</button>

            </td>
            @if (ViewBag.username != "External")
            {
                <td width="2%" align="right" style="z-index: 999; padding-right: 5px;" >
                    <button type="button" title="View page settings" data-toggle="modal" data-target="#settingsModal"><span class="glyphicon glyphicon-cog"></span></button>
                </td>
            }

        </tr>
    </table>
</div>

<div id="application-tabs" class="noselect">
<ul>
    <li id="tabsOverviewToday"><a href="#tabs-Overview-Today">Overview-Today</a></li>
    <li id="tabsOverviewYesterday"><a href="#tabs-Overview-Yesterday">Overview-Yesterday</a></li>
    <li id="tabsEvents"><a href="#tabs-Events">Events</a></li>
    <li id="tabsDisturbances"><a href="#tabs-Disturbances">Disturbances</a></li>
    <li id="tabsFaults"><a href="#tabs-Faults">Faults</a></li>
    <li id="tabsBreakers"><a href="#tabs-Breakers">Breakers</a></li>
    <li id="tabsTrending"><a href="#tabs-Trending">Trending</a></li>
    <li id="tabsTrendingData"><a href="#tabs-TrendingData">TrendingData</a></li>
    <li id="tabsCompleteness"><a href="#tabs-Completeness">Completeness</a></li>
    <li id="tabsCorrectness"><a href="#tabs-Correctness">Correctness</a></li>
    <li id="tabsModbusData"><a href="#tabs-ModbusData">ModbusData</a></li>
    <li id="tabsHistorianData"><a href="#tabs-HistorianData">HistorianData</a></li>
</ul>

<div id="tabs-Overview-Today">
    <img class="overviewImg" src="~/Images/todaymockup.png"/>
    <div id="overviewContainer" class="container" style="background-color: #005ce6; width: 100%; height: 100%; text-align: center">
        <div style="text-align: center; color: white">
            <h3>PQ Overview for <span id="overviewDate"></span></h3>
        </div>
        <div style="height: 1px; width: 80%; display: inline-block; background-color: #66ffe0"></div>
        <div id="elementContainer">
            <div id="meters"></div>
            <div id="alarms"></div>
            <div id="offnormal"></div>
            <div id="last30days"></div>
            <div id="voltageDisturbances"></div>
            <div id="faults"></div>
        </div>
    </div>
</div>

    <!-- Modal -->
<div id="settingsModal" class="modal fade" style="z-index: 300" role="dialog">
    <div class="modal-dialog" style="width: 90%; height:100%; z-index: 300">

        <!-- Modal content-->
        <div class="modal-content" style="z-index: 300">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">PQDashboard Settings for @ViewBag.username</h4>
            </div>
            <div class="modal-body" style="height: 95%; overflow-y: scroll">
                <div style="position: relative">
                    <em>Settings are automatically udpated after a change is made.  To see results the browser must be refreshed. Click below to refresh immediately or not.</em>
                    <div class="grid">
                        <div class="grid-item">
                            <h4><u>Tabs</u></h4>
                            <div class="well">
                                <table>
                                    @foreach (DashSettings setting in dashSettings)
                                    {
                                        if (setting.Name == "DashTab")
                                        {
                                            <tr>
                                                <td>
                                                    @setting.Value
                                                </td>
                                                <td>
                                                    <input id="tab@(setting.ID)" type="checkbox" @(setting.Enabled ? "checked='checked'" : "")/>
                                                </td>
                                            </tr>
                                        }
                                    }
                                </table>
                            </div>
                        </div>

                        @foreach (DashSettings setting in dashSettings)
                        {
                            if (setting.Name == "DashTab" && setting.Enabled && (new List<string>() {"#tabsOverviewToday", "#tabsOverviewYesterday", "#tabsTrendingData", "#tabsModbusData", "#tabsHistorianData"}).IndexOf(setting.Value) < 0)
                            {
                                <div class="grid-item">

                                    <h4><u>@setting.Value.Substring(5)</u></h4>
                                    <div class="well">
                                        <table>
                                            <thead>
                                            <tr>
                                                <th>Field</th>
                                                <th>Color</th>
                                                <th>Enabled</th>
                                            </tr>
                                            </thead>
                                            @foreach (DashSettings innerSetting in dashSettings)
                                            {
                                                if (setting.Value.Substring(5) + "Chart" == innerSetting.Name)
                                                {
                                                    <tr>
                                                        <td>
                                                            @innerSetting.Value
                                                        </td>
                                                        <td>
                                                            @{
                                                                DashSettings color = dashSettings.Where(x => x.Name.Contains(setting.Value.Substring(5) + "ChartColors") && string.Compare(innerSetting.Value, x.Value.Split(',')[0]) == 0)?.FirstOrDefault();

                                                            }
                                                            <input id="color@(color.ID)"class="jscolor" value="@(color?.Value.Split(',')?[1] ?? "")"/>
                                                        </td>
                                                        <td>
                                                            <input id="enable@(innerSetting.ID)"type="checkbox" @(innerSetting.Enabled ? "checked='checked'" : "")/>
                                                        </td>
                                                    </tr>
                                                }
                                            }
                                        </table>
                                    </div>
                                </div>

                            }
                        }
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="refresh()">Apply Now</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>


<div id="tabs-Overview-Yesterday">
    <img class="overviewImg" src="~/Images/yesterdaymockup.png"/>
    <div id="overviewContainer" class="container" style="background-color: #005ce6; width: 100%; height: 100%; text-align: center">
        <div style="text-align: center; color: white">
            <h3>PQ Overview for <span id="overviewDate"></span></h3>
        </div>
        <div style="height: 1px; width: 80%; display: inline-block; background-color: #66ffe0"></div>
        <div id="elementContainer">
            <div id="meters"></div>
            <div id="alarms"></div>
            <div id="offnormal"></div>
            <div id="last30days"></div>
            <div id="voltageDisturbances"></div>
            <div id="faults"></div>
        </div>
    </div>
</div>

<div id="tabs-ModbusData">
    <iframe id="modbusFrame"></iframe>
</div>

<div id="tabs-HistorianData">
    <iframe id="historianFrame"></iframe>
</div>

<div id="tabs-Events">
    <div id="column_1" class="column resizeable">
        <div class="portlet" id="Portlet1Events">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">Events Overview (For Date Range)</div>
            </div>
            <div id="DockOverviewEvents" class="portlet-content">
                <div id="OverviewEvents" class="docklet chart-container">
                </div>
            </div>
        </div>
        <div class="portlet" id="Portlet2Events">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">
                    Events Detail for&nbsp;
                    <div style="display: inline;" id="eventsDetailHeader">Date</div>&nbsp;(24 Hours)
                </div>
            </div>
            <div id="DockDetailEvents" class="portlet-content noselect">
                <div id="DetailEvents" class="docklet">
                    <div id="DetailEventsTable"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="column_2" class="column">
        <div class="portlet">
            <div class="portlet-header portlet-header-text">
                <div class="header-container">
                    <div class="siteselectdropdown" style="position: absolute;">
                        <select class="smallbutton mapGrid" id="mapEventsGrid" onchange="selectmapgrid(this);">
                            <option value="Map">Map</option>
                            <option value="Grid">Grid</option>
                        </select>
                        <select class="smallbutton" id="selectSiteSetEvents" onchange="showSiteSet(this);">
                            <option value="All">All Sites</option>
                            <option value="Events">Events</option>
                            <option value="NoEvents">No Events</option>
                            <option value="SelectedSites">Selected Sites</option>
                            <option value="None">None</option>
                        </select>
                        <select class="smallbutton" id="selectHeatmapEvents" onchange="showHeatmap(this);">
                            <option value="EventCounts">Event Counts</option>
                            <option value="MinimumSags">Sag Minimum</option>
                            <option value="MaximumSwell">Swell Maximum</option>
                        </select>
                    </div>

                    <div class="overlaydate pull-right">
                            <div id="mapHeaderEventsFrom" class="mapheader"></div>
                            <div id="mapHeaderEventsDivider" class="mapheader">&nbsp;-&nbsp;</div>
                            <div id="mapHeaderEventsTo" class="mapheader"></div>
                    </div>

                </div>

            </div>

            <div id="MapMatrixEvents" class="portlet-content portlet-header-text">
                <div class="theMapStyle" id="theMapEvents"></div>
                <div class="theMatrixStyle noselect" id="theMatrixEvents"></div>
            </div>
        </div>
    </div>
</div>

<div id="tabs-Disturbances">
    <div id="column_13" class="column resizeable">
        <div class="portlet" id="Portlet1Disturbances">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">Disturbances Overview (For Date Range)</div>
                <select class="smallbutton pull-right" style="margin-right: 20px" onchange="showMagDur(this)">
                    <option value="0">Bar Chart</option>
                    <option value="1">Mag/Dur Chart</option>
                </select>
            </div>
            <div id="DockOverviewDisturbances" class="portlet-content">
                <div id="OverviewDisturbances" class="docklet chart-container"></div>
                <div id="OverviewDisturbancesMagDur" class="docklet chart-container" style="display: none"></div>
            </div>
        </div>
        <div class="portlet" id="Portlet2Disturbances">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">
                    Disturbances Detail for&nbsp;
                    <div style="display: inline;" id="DisturbancesDetailHeader">Date</div>&nbsp;(24 Hours)
                </div>
            </div>
            <div id="DockDetailDisturbances" class="portlet-content noselect">
                <div id="DetailDisturbances" class="docklet">
                    <div id="DetailDisturbancesTable"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="column_14" class="column">
        <div class="portlet">
            <div class="portlet-header portlet-header-text">
                <div class="header-container">
                    <div class="siteselectdropdown" style="position: absolute;">
                        <select class="smallbutton mapGrid" id="mapDisturbancesGrid" onchange="selectmapgrid(this);">
                            <option value="Map">Map</option>
                            <option value="Grid">Grid</option>
                        </select>
                        <select class="smallbutton" id="selectSiteSetDisturbances" onchange="showSiteSet(this);">
                            <option value="All">All Sites</option>
                            <option value="Disturbances">Disturbances</option>
                            <option value="NoDisturbances">No Disturbances</option>
                            <option value="SelectedSites">Selected Sites</option>
                            <option value="None">None</option>
                        </select>
                        <select class="smallbutton" id="selectHeatmapDisturbances" onchange="showHeatmap(this);">
                            <option value="DisturbanceCounts">Disturbance Counts</option>
                        </select>
                    </div>

                    <div class="overlaydate pull-right">
                        <div id="mapHeaderDisturbancesFrom" class="mapheader"></div>
                        <div id="mapHeaderDisturbancesDivider" class="mapheader">&nbsp;-&nbsp;</div>
                        <div id="mapHeaderDisturbancesTo" class="mapheader"></div>
                    </div>

                </div>

            </div>

            <div id="MapMatrixDisturbances" class="portlet-content portlet-header-text">
                <div class="theMapStyle" id="theMapDisturbances"></div>
                <div class="theMatrixStyle noselect" id="theMatrixDisturbances"></div>
            </div>
        </div>
    </div>
</div>

<div id="tabs-Trending">
    <div id="column_3" class="column resizeable">
        <div class="portlet" id="Portlet1Trending">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">Trending Overview (Past 30 Days)</div>
            </div>
            <div id="DockOverviewTrending" class="portlet-content">
                <div id="OverviewTrending" class="docklet">
                </div>
            </div>
        </div>
        <div class="portlet" id="Portlet2Trending">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">
                    Trending Detail for
                    <div style="display: inline;" id="trendingDetailHeader">Date</div>
                    &nbsp;(24 Hours)
                    @*<%--<div style="height: 18px; display: block; float: right; margin-right: 30px; margin-top: 5px;"><input type="image" src="~/Images/fileexport.png" id="excelExportTrending" title="Export To Excel"/></div>--%>*@
                </div>
            </div>
            <div id="DockDetailTrending" class="portlet-content">
                <div id="DetailTrending" class="docklet">
                    <div id="DetailTrendingTable"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="column_4" class="column">
        <div class="portlet">
            <div class="portlet-header portlet-header-text">
                <div class="header-container">
                    <div class="siteselectdropdown" style="position: absolute;">
                        <select class="smallbutton mapGrid" id="mapTrendingGrid" onchange="selectmapgrid(this);">
                            <option value="Map">Map</option>
                            <option value="Grid">Grid</option>
                        </select>
                        <select class="smallbutton" id="selectSiteSetTrending" onchange="showSiteSet(this);">
                            <option value="All">All Sites</option>
                            <option value="Events">Events</option>
                            <option value="NoEvents">No Events</option>
                            <option value="SelectedSites">Selected Sites</option>
                            <option value="None">None</option>
                        </select>
                        <select class="smallbutton" id="selectHeatmapTrending" onchange="showHeatmap(this);">
                            <option value="TrendingCounts">Alarm Counts</option>
                        </select>
                    </div>
                    <div class="overlaydate pull-right">
                        <div id="mapHeaderTrendingFrom" class="mapheader noselect"></div>
                        <div id="mapHeaderTrendingDivider" class="mapheader noselect">&nbsp;-&nbsp;</div>
                        <div id="mapHeaderTrendingTo" class="mapheader noselect"></div>
                    </div>
                </div>
            </div>
            <div id="MapMatrixTrending" class="portlet-content portlet-header-text">
                <div class="theMapStyle" id="theMapTrending"></div>
                <div class="theMatrixStyle noselect" id="theMatrixTrending"></div>
            </div>
        </div>
    </div>
</div>

<div id="tabs-TrendingData">
    <div id="column_5" class="column resizeable">
        <div class="portlet" id="Portlet1TrendingData">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">Trending Data Overview (Past 30 Days)</div>
            </div>
            <div id="DockOverviewTrendingData" class="portlet-content">
                <div id="OverviewTrendingData" class="docklet">
                </div>
            </div>
        </div>
        <div class="portlet" id="Portlet2TrendingData">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">
                    Trending Data Detail for
                    <div style="display: inline;" id="trendingDataDetailHeader">Date</div>
                    &nbsp;(24 Hours)
                </div>
            </div>
            <div id="DockDetailTrendingData" class="portlet-content">
                <div id="DetailTrendingData" class="docklet">
                    <div id="DetailTrendingDataTable"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="column_6" class="column">
        <div class="portlet">
            <div class="portlet-header portlet-header-text">
                <div class="header-container">
                    <div class="siteselectdropdown" style="position: absolute;">
                        <select class="smallbutton mapGrid" id="mapTrendingDataGrid" onchange="selectmapgrid(this);">
                            <option value="Map">Map</option>
                            <option value="Grid">Grid</option>
                        </select>
                        <select class="smallbutton" id="selectSiteSetTrendingData" onchange="showSiteSet(this);">
                            <option value="All">All Sites</option>
                            <option value="RecievedData">Recieved Data</option>
                            <option value="NoData">No Data</option>
                            <option value="SelectedSites">Selected Sites</option>
                            <option value="None">None</option>
                        </select>
                        <select class="smallbutton" id="trendingDataTypeSelection" onchange="showType(this);">
                            <option value="Average">Average</option>
                            <option value="Maximum">Maximum</option>
                            <option value="Minimum">Minimum</option>
                        </select>
                        <select class="smallbutton" id="contourColorScaleSelect" onchange="showColorScale(this);">
                        </select>
                    </div>
                    <div class="overlaydate pull-right">
                        <div id="mapHeaderTrendingDataFrom" class="mapheader noselect"></div>
                        <div id="mapHeaderTrendingDataDivider" class="mapheader noselect">&nbsp;-&nbsp;</div>
                        <div id="mapHeaderTrendingDataTo" class="mapheader noselect"></div>
                    </div>


                </div>
            </div>
            <div id="MapMatrixTrendingData" class="portlet-content portlet-header-text">
                <div class="theMapStyle" id="theMapTrendingData">
                </div>
                <div class="theMatrixStyle noselect" id="theMatrixTrendingData"></div>
            </div>
        </div>
    </div>
</div>

<div id="tabs-Faults">
    <div id="Div3" class="column resizeable">
        <div class="portlet" id="Portlet1Faults">
            <div class="portlet-header portlet-header-text">Faults Overview</div>
            <div id="DockOverviewFaults" class="portlet-content">
                <div id="OverviewFaults" class="docklet chart-container">
                </div>
            </div>
        </div>
        <div class="portlet" id="Portlet2Faults">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">
                    Faults Summary for&nbsp;
                    <div style="display: inline;" id="faultsDetailHeader">Date</div>&nbsp;(24 Hours)
                </div>
            </div>
            <div id="DockDetailFaults" class="portlet-content noselect">
                <div id="DetailFaults" class="docklet">
                    <div id="DetailFaultsTable"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="Div4" class="column">
        <div class="portlet" id="Portlet3Faults">
            <div class="portlet-header portlet-header-text">
                <div class="header-container">
                    <div class="siteselectdropdown" style="position: absolute;">
                        <select class="smallbutton mapGrid" id="mapFaultsGrid" onchange="selectmapgrid(this);">
                            <option value="Map">Map</option>
                            <option value="Grid">Grid</option>
                        </select>
                        <select class="smallbutton" id="selectSiteSetFaults" onchange="showSiteSet(this);">
                            <option value="All">All Sites</option>
                            <option value="Events">Events</option>
                            <option value="NoEvents">No Events</option>
                            <option value="SelectedSites">Selected Sites</option>
                            <option value="None">None</option>
                        </select>
                    </div>
                    <div class="overlaydate pull-right">
                        <div id="mapHeaderFaultsFrom" class="mapheader noselect"></div>
                        <div id="mapHeaderFaultsDivider" class="mapheader noselect">&nbsp;-&nbsp;</div>
                        <div id="mapHeaderFaultsTo" class="mapheader noselect"></div>
                    </div>
                </div>
            </div>
            <div id="MapMatrixFaults" class="portlet-content">
                <div class="theMapStyle" id="theMapFaults"></div>
                <div class="theMatrixStyle noselect" id="theMatrixFaults"></div>
            </div>
        </div>
    </div>
</div>

<div id="tabs-Breakers">
    <div id="Div1" class="column resizeable">
        <div class="portlet" id="Portlet1Breakers">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">Breaker Overview (For Date Range)</div>
            </div>
            <div id="DockOverviewBreakers" class="portlet-content">
                <div id="OverviewBreakers" class="docklet chart-container">
                </div>
            </div>
        </div>
        <div class="portlet" id="Portlet2Breakers">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">
                    Breaker Detail for&nbsp;
                    <div style="display: inline;" id="breakersDetailHeader">Date</div>&nbsp;(24 Hours)
                </div>
            </div>
            <div id="DockDetailBreakers" class="portlet-content noselect">
                <div id="DetailBreakers" class="docklet">
                    <div id="DetailBreakersTable"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="Div2" class="column">
        <div class="portlet">
            <div class="portlet-header portlet-header-text">
                <div class="header-container">
                    <div class="siteselectdropdown" style="position: absolute;">
                        <select class="smallbutton mapGrid" id="mapBreakersGrid" onchange="selectmapgrid(this);">
                            <option value="Map">Map</option>
                            <option value="Grid">Grid</option>
                        </select>

                        <select class="smallbutton" id="selectSiteSetBreakers" onchange="showSiteSet(this);">
                            <option value="All">All Sites</option>
                            <option value="Events">Events</option>
                            <option value="NoEvents">No Events</option>
                            <option value="SelectedSites">Selected Sites</option>
                            <option value="None">None</option>
                        </select>
                    </div>
                    <div class="overlaydate pull-right">
                        <div id="mapHeaderBreakersFrom" class="mapheader noselect"></div>
                        <div id="mapHeaderBreakersDivider" class="mapheader noselect">&nbsp;-&nbsp;</div>
                        <div id="mapHeaderBreakersTo" class="mapheader noselect"></div>
                    </div>
                </div>
            </div>
            <div id="MapMatrixBreakers" class="portlet-content portlet-header-text">
                <div class="theMapStyle" id="theMapBreakers"></div>
                <div class="theMatrixStyle noselect" id="theMatrixBreakers"></div>
            </div>
        </div>
    </div>
</div>

<div id="tabs-Completeness">
    <div id="Div5" class="column resizeable">
        <div class="portlet" id="Portlet1Completeness">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">Completeness Overview (For Date Range)</div>
            </div>
            <div id="DockOverviewCompleteness" class="portlet-content">
                <div id="OverviewCompleteness" class="docklet chart-container">
                </div>
            </div>
        </div>
        <div class="portlet" id="Portlet2Completeness">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">
                    Completeness Detail for&nbsp;
                    <div style="display: inline;" id="CompletenessDetailHeader">Date</div>&nbsp;(24 Hours)
                </div>
            </div>
            <div id="DockDetailCompleteness" class="portlet-content noselect">
                <div id="DetailCompleteness" class="docklet chart-container">
                    <div id="DetailCompletenessTable"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="Div6" class="column">
        <div class="portlet">
            <div class="portlet-header portlet-header-text">
                <div class="header-container">
                    <div class="siteselectdropdown" style="position: absolute;">
                        <select class="smallbutton mapGrid" id="mapCompletenessGrid" onchange="selectmapgrid(this);">
                            <option value="Map">Map</option>
                            <option value="Grid">Grid</option>
                        </select>

                        <select class="smallbutton" id="selectSiteSetCompleteness" onchange="showSiteSet(this);">
                            <option value="All">All Sites</option>
                            <option value="Events">Events</option>
                            <option value="NoEvents">No Events</option>
                            <option value="SelectedSites">Selected Sites</option>
                            <option value="None">None</option>
                        </select>
                    </div>
                    <div class="overlaydate pull-right">
                        <div id="mapHeaderCompletenessFrom" class="mapheader noselect"></div>
                        <div id="mapHeaderCompletenessDivider" class="mapheader noselect">&nbsp;-&nbsp;</div>
                        <div id="mapHeaderCompletenessTo" class="mapheader noselect"></div>
                    </div>
                </div>
            </div>
            <div id="MapMatrixCompleteness" class="portlet-content portlet-header-text">
                <div class="theMapStyle" id="theMapCompleteness"></div>
                <div class="theMatrixStyle noselect" id="theMatrixCompleteness"></div>
            </div>
        </div>
    </div>
</div>

<div id="tabs-Correctness">
    <div id="Div7" class="column resizeable">
        <div class="portlet" id="Portlet1Correctness">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">Correctness Overview (For Date Range)</div>
            </div>
            <div id="DockOverviewCorrectness" class="portlet-content">
                <div id="OverviewCorrectness" class="docklet chart-container">
                </div>
            </div>
        </div>
        <div class="portlet" id="Portlet2Correctness">
            <div class="portlet-header">
                <div class="portlet-header-text" style="display: inline">
                    Correctness Detail for&nbsp;
                    <div style="display: inline;" id="CorrectnessDetailHeader">Date</div>&nbsp;(24 Hours)
                </div>
            </div>
            <div id="DockDetailCorrectness" class="portlet-content noselect">
                <div id="DetailCorrectness" class="docklet">
                    <div id="DetailCorrectnessTable"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="Div8" class="column">
        <div class="portlet">
            <div class="portlet-header portlet-header-text">
                <div class="header-container">
                    <div class="siteselectdropdown" style="position: absolute;">
                        <select class="smallbutton mapGrid" id="mapCorrectnessGrid" onchange="selectmapgrid(this);">
                            <option value="Map">Map</option>
                            <option value="Grid">Grid</option>
                        </select>

                        <select class="smallbutton" id="selectSiteSetCorrectness" onchange="showSiteSet(this);">
                            <option value="All">All Sites</option>
                            <option value="Events">Events</option>
                            <option value="NoEvents">No Events</option>
                            <option value="SelectedSites">Selected Sites</option>
                            <option value="None">None</option>
                        </select>
                    </div>
                    <div class="overlaydate pull-right">
                        <div id="mapHeaderCorrectnessFrom" class="mapheader noselect"></div>
                        <div id="mapHeaderCorrectnessDivider" class="mapheader noselect">&nbsp;-&nbsp;</div>
                        <div id="mapHeaderCorrectnessTo" class="mapheader noselect"></div>
                    </div>
                </div>
            </div>
            <div id="MapMatrixCorrectness" class="portlet-content portlet-header-text">
                <div class="theMapStyle" id="theMapCorrectness"></div>
                <div class="theMatrixStyle noselect" id="theMatrixCorrectness"></div>
            </div>
        </div>
    </div>
</div>
</div>

<div id="modal-dialog" class="configNameModal" title="New Configuration">
    <center>
        <table><tr><td><label for="newconfigname">Name:</label></td><td><input type="text" id="newconfigname" value="" maxLength="25"></td></tr></table>
    </center>
</div>

<div id="delete-dialog" class="configNameModal" title="Delete Confirmation">
    <center>
        <table>
            <tr>
                <td align="right" nowrap>
                    Delete:
                </td>
                <td align="left" nowrap>
                    <div id="deleteconfigname"></div>
                </td>
                <td align="left" nowrap>
                    ?
                </td>
            </tr>
        </table>
    </center>
</div>
</div>


<!-- Modals -->
<div id="notesModal" class="modal fade" role="dialog">
    <div class="modal-dialog" style="width: 50%">

        <!-- Modal content-->
        <div class="modal-content" >
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Add a note to fault record <span id="faultId"></span></h4>
            </div>
            <div id="previousNotesDiv">
                
            </div>
            <div class="modal-body">
                <textarea id="note" class="form-control"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="saveNote()">Save</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

<div id="deviceFilterModal" class="modal fade" role="dialog">
    <div class="modal-dialog" style="width: 50%">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Add/Edit a device filter.</h4>
            </div>
            <div class="modal-body">
                <label for="deviceFilterName">Name:</label>
                <input type="text" class="form-control" id="deviceFilterName"/>
                <label for="deviceFilterName">Meter Group:</label>
                <select class="form-control" id="meterGroups"></select>
                <label for="filterExpression">Filter Expression:</label>
                <textarea id="filterExpression" class="form-control"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="saveDeviceFilter()">Save</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    const DateTimeFormat = '@Model.Global.DateTimeFormat'
    //////////////////////////////////////////////////////////////////////////////////////////////////////////
    // The following function are for making button links to another page and opening another page
    function filterMakeFaultSpecificsButton_html(id) {
        var return_html = "";
        if (id.eventtype == "Fault") {
            return_html = makeFaultSpecificsButton_html(id);
        }
        return (return_html);
    }

    function makeFaultSpecificsButton_html(id) {
        var return_html = "";
        return_html += '<div style="width: 100%; Height: 100%; text-align: center; margin: auto; border: 0 none;">';
        return_html += '<button onClick="OpenWindowToFaultSpecifics(' + id.theeventid + ');" value="" style="cursor: pointer; text-align: center; margin: auto; border: 0 none;" title="Open Fault Detail Window">';
        return_html += '<img src="@Html.Raw(Url.Content("~/Images/faultDetailButton.png"))" /></button></div>';
        return (return_html);
    }

    function OpenWindowToFaultSpecifics(id) {
        var datarow = id;
        var popup = window.open("@Html.Raw(Url.Content("~/FaultSpecifics.aspx"))?eventid=" + id, id + "FaultLocation", "left=0,top=0,width=300,height=200,status=no,resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no");
        return false;
    }

    function makeOpenSEEButton_html(id) {
        var return_html = "";
        return_html += '<div style="cursor: pointer; width: 100%; Height: 100%; text-align: center; margin: auto; border: 0 none;">';
        return_html += '<button onClick="OpenWindowToOpenSEE(' + id.theeventid + ',' + id.breakeroperationid + ');" value="" style="cursor: pointer; text-align: center; margin: auto; border: 0 none;" title="Launch OpenSEE Waveform Viewer">';
        return_html += '<img src="@Html.Raw(Url.Content("~/Images/seeButton.png"))" /></button></div>';
        return (return_html);
    }

    function makeOpenSTEButton_html(id) {
        var return_html = "";
        var url = "'@Html.Raw(Url.Content("~/Main/openSTE"))?channelid=" + encodeURIComponent(id.channelid)
            + "&date=" + encodeURIComponent(id.date)
            + "&meterid=" + encodeURIComponent(id.meterid)
            + "&measurementtype=" + encodeURIComponent(id.measurementtype)
            + "&characteristic=" + encodeURIComponent(id.characteristic)
            + "&phasename=" + encodeURIComponent(id.phasename) + "'";
        return_html += '<div style="cursor: pointer; width: 100%; Height: 100%; text-align: center; margin: auto; border: 0 none;">';
        return_html += '<button onclick="OpenWindowToOpenSTE( ' + url + ',' + id.channelid + ' )" value="" style="cursor: pointer; text-align: center; margin: auto; border: 0 none;" title="Launch OpenSTE Trending Viewer">';
        return_html += '<img src="@Html.Raw(Url.Content("~/Images/steButton.png"))" /></button></div>';
        return (return_html);
    }

    function OpenWindowToOpenSTE(url, id) {
        var popup = window.open(url, id + "openSTE");
        return false;
    }


    function OpenWindowToOpenSEE(id, breaker) {
        var url = "@Html.Raw(Url.Content("~/Main/OpenSEE"))?eventid=" + id;

        if (currentTab === "Breakers")
            url += "&breakeroperation=" + breaker + "&breakerdigitals=1";
        else
            url += "&faultcurves=1";

        var popup = window.open(url, id + "openSEE");
        return false;
    }

    function makeChannelDataQualityButton_html(id) {
        var return_html = "";
        return_html += '<div style="cursor: pointer; width: 100%; Height: 100%; text-align: center; margin: auto; border: 0 none;">';
        return_html += '<button onClick="OpenWindowToChannelDataQuality(' + id.theeventid + ');" value="" style="cursor: pointer; text-align: center; margin: auto; border: 0 none;" title="Launch Channel Data Quality Details Page">';
        return_html += '<img src="@Html.Raw(Url.Content("~/Images/dqDetailButton.png"))" /></button></div>';
        return (return_html);
    }

    function makeChannelCompletenessButton_html(id) {
        var return_html = "";
        return_html += '<div style="cursor: pointer; width: 100%; Height: 100%; text-align: center; margin: auto; border: 0 none;">';
        return_html += '<button onClick="OpenWindowToChannelDataCompleteness(' + id.theeventid + ');" value="" style="cursor: pointer; text-align: center; margin: auto; border: 0 none;" title="Launch Channel Data Quality Details Page">';
        return_html += '<img src="@Html.Raw(Url.Content("~/Images/dcDetailButton.png"))" /></button></div>';
        return (return_html);
    }

    function makeMeterEventsByLineButton_html(id) {
        var return_html = "";
        return_html += '<div style="cursor: pointer; width: 100%; Height: 100%; text-align: center; margin: auto; border: 0 none;">';
        return_html += '<button onClick="OpenWindowToMeterEventsByLine(' + id.theeventid + ');" value="" style="cursor: pointer; text-align: center; margin: auto; border: 0 none;" title="Launch Events List Page">';
        return_html += '<img src="@Html.Raw(Url.Content("~/Images/eventDetailButton.png"))" /></button></div>';
        return (return_html);
    }

    function OpenWindowToMeterEventsByLine(id) {
        var popup = window.open("@Html.Raw(Url.Content("~/Main/MeterEventsByLine"))?eventid=" + id, id + "MeterEventsByLine");
        return false;
    }

    function OpenWindowToMeterDisturbancesByLine(id) {
        var popup = window.open("@Html.Raw(Url.Content("~/Main/MeterDisturbancesByLine"))?eventid=" + id, id + "MeterDisturbancesByLine");
        return false;
    }


    function OpenWindowToChannelDataQuality(id) {
        var popup = window.open("@Html.Raw(Url.Content("~/ChannelDataQuality.aspx"))?eventid=" + id, id + "ChannelDataQuality");
        return false;
    }

    function OpenWindowToChannelDataCompleteness(id) {
        var popup = window.open("@Html.Raw(Url.Content("~/ChannelDataCompleteness.aspx"))?eventid=" + id, id + "ChannelDataCompleteness");
        return false;
    }
    
    function refresh(){
        location.reload();
    }

    //////////////////////////////////////////////////////////////////////////////////////////////

    </script>

</body>

</html>
